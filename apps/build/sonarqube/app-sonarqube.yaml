apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: sonarqube
  namespace: argocd
spec:
  project: build
  source:
    chart: sonarqube
    repoURL: https://sonarSource.github.io/helm-chart-sonarqube
    targetRevision: 2025.4.2
    helm:
      releaseName: sonarqube
      values: |
        community:
          enabled: true
        monitoringPasscode: homelab
        resources:
          requests:
            cpu: 2
            memory: 6144M
          limits:
            cpu: 4
            memory: 12288M
        jdbcOverwrite:
          enabled: true
          jdbcUrl: "jdbc:postgresql://postgresql-cluster-homelab-rw.data/sonarqube"
          jdbcUsername: "sonarqube"
          jdbcSecretName: sonarqube-db-config
          jdbcSecretPasswordKey: SONARQUBE_JDBC_PASSWORD
        postgresql:
          enabled: false
        persistence:
          enabled: true
          size: 100Gi
        ingress:
          nginx:
            enabled: true
          ingressClassName: nginx
          annotations:
            kubernetes.io/ingress.class: nginx
            nginx.ingress.kubernetes.io/proxy-body-size: 10g
            cert-manager.io/cluster-issuer: lets-encrypt
          hosts:
          - name: sonarqube.galluman.com
            path: "/"
          tls:
          - hosts:
            - sonarqube.galluman.com
            secretName: sonarqube-ingress-tls
  destination:
    server: "https://kubernetes.default.svc"
    namespace: build
  syncPolicy:
    automated: {}
