apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: traefik
  namespace: argocd
spec:
  project: build
  source:
    chart: traefik
    repoURL: https://traefik.github.io/charts
    targetRevision: 37.1.2
    helm:
      releaseName: traefik
      values: |
        ports:
          # Defines the HTTP entry point named 'web'
          web:
            port: 8080
            nodePort: 30080
            # Instructs this entry point to redirect all traffic to the 'websecure' entry point
            redirections:
              entryPoint:
                to: websecure
                scheme: https
                permanent: true
          # Defines the HTTPS entry point named 'websecure'
          websecure:
            port: 8443
            nodePort: 30443

        # Enables the dashboard in Secure Mode
        api:
          dashboard: true
          insecure: true
        ingressRoute:
          dashboard:
            enabled: true
            entryPoints:
              - web

        # We will route with Gateway API instead.
        ingressClass:
          enabled: false

        # Enable Gateway API Provider & Disables the KubernetesIngress provider
        # Providers tell Traefik where to find routing configuration.
        providers:
          kubernetesIngress:
            enabled: false
          kubernetesGateway:
            enabled: true


        ## Gateway Listeners
        gateway:
          listeners:
            web:           # HTTP listener that matches entryPoint `web`
              port: 8080
              protocol: HTTP
              namespacePolicy:
                from: All

        # providers:
        #   kubernetesIngress:
        #     enabled: false
        #   kubernetesGateway:
        #     enabled: true
        # gatewayClass:
        #   enabled: true
        #   name: "default"
        # experimental:
        #   kubernetesGateway:
        #     enabled: true
        # ingressClass:
        #   enabled: false
        # service:
        #   enabled: true
        #   type: ClusterIP
        # ingressRoute:
        #   dashboard:
        #     enabled: true
        # api:
        #   dashboard: true
        #   insecure: true
  destination:
    server: "https://kubernetes.default.svc"
    namespace: build
  syncPolicy:
    automated: {}

