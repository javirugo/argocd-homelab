apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: traefik
  namespace: argocd
spec:
  project: build
  source:
    chart: traefik
    repoURL: https://traefik.github.io/charts
    targetRevision: 37.1.2
    helm:
      releaseName: traefik
      values: |
        # --- General ---
        deployment:
          enabled: true
          replicas: 1

        # --- Entry points & ports ---
        ports:
          web:
            port: 80
            expose:
              default: true
            exposedPort: 80
            nodePort: 30080
            protocol: TCP

          websecure:
            port: 443
            expose:
              default: true
            exposedPort: 443
            nodePort: 30443
            protocol: TCP

          traefik:
            port: 9000
            expose:
              default: true
            exposedPort: 9000
            protocol: TCP

        service:
          enabled: true
          type: NodePort
          spec:
            externalTrafficPolicy: Cluster
          ports:
            web:
              nodePort: 30080
            websecure:
              nodePort: 30443
            traefik:
              # dashboard (ClusterIP only)
              nodePort: null

        # --- Providers ---
        providers:
          kubernetesIngress:
            enabled: false
          kubernetesCRD:
            enabled: false
          kubernetesGateway:
            enabled: true
            experimentalChannel: true

        # --- Dashboard ---
        dashboard:
          enabled: true
          domain: traefik.local
          service:
            type: ClusterIP
          ingressRoute: false

        # --- Logging ---
        logs:
          general:
            level: INFO
          access:
            enabled: true

        # --- Disable Pilot, Metrics, Tracing ---
        pilot:
          enabled: false

        metrics:
          prometheus:
            enabled: false

        # Do not define tracing.enabled here, just omit

        # --- Extra Arguments ---
        additionalArguments:
          - "--providers.kubernetesgateway=true"
          - "--providers.kubernetescrd=false"
          - "--providers.kubernetesingress=false"
          - "--api.dashboard=true"
          - "--entrypoints.web.address=:80"
          - "--entrypoints.websecure.address=:443"
          - "--entrypoints.traefik.address=:9000"

  destination:
    server: "https://kubernetes.default.svc"
    namespace: build
  syncPolicy:
    automated: {}

